<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">-->
<!doctype html>
<!--<html xmlns:fb="http://www.facebook.com/2008/fbml">-->

<html xmlns:fb="http://ogp.me/ns/fb#">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=980" />
  <title>Vertical</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="../../js/porthole.min.js"></script>
  <script type="text/javascript">
    (function() {
      console.log("cargando framefb.html");
      window.fbAsyncInit = function () {
        FB.init({appId: '486640894740634', status: true, cookie: true, xfbml: true, oauth  : true });
        console.log('FB.init called.');
//        Winbits.facebookLoaded = true;

      };
      (function () {
        var e = document.createElement('script');
        e.async = true;
        e.src = 'http://connect.facebook.net/en_US/all.js';
        (document.getElementsByTagName('head')[0] || document.documentElement).appendChild(e);
      }());

      window.onload=function(){


        // Create a proxy window to send to and receive
        // messages from the iFrame
        windowProxy = new Porthole.WindowProxy(
            'http://www.looq.com/proxy.html');

        // Register an event handler to receive messages;
        windowProxy.addEventListener(function (messageEvent) {
          console.log(['Message from LOOQ', messageEvent]);
          var data = messageEvent.data;
          var actionFn = Facebook[data.action];
          if (actionFn) {
            actionFn.apply(data.params);
          } else {
            console.log('Invalid action from Winbits');
          }
        });
      };

      var Facebook = {
        login: function() {
          console.log("*********Haciendo login a Facebook-Feed")
          document.getElementById('fbl').click();

        },
        me: function() {
          console.log("En ME")
          FB.api('/me', function(response){
            console.log("respondio informacion");
            console.log("-"+response.id+", "+response.name, +", "+ response.email);
            windowProxy.post({action: 'me', params: [response]});

            		});



        }
      };
    })();
    function sendLoginFB (){
      console.log("en sendLoginFB");
      FB.login(function(response) {
      console.log("response : " + response)
      console.log("response : " + response.authResponse)

        windowProxy.post({action: 'login', params: [response]});
      }, {scope: 'email,user_about_me,user_birthday'});

    }
  </script>
</head>
<body>
<div id="fb-root">
  <button id="facebook-btn" onclick="sendLoginFB()" style="background-color: #000088;color: #ffffff;">Login Facebook</button>
  <!--<fb:login-button show-faces="true" width="149" max-rows="1" id="fbl" name="fbl">Login con Facebook</fb:login-button>-->
</div>
</body>
</html>